---
import { format } from 'date-fns';
import TagList from './TagList.astro';

export interface Props {
  title: string;
  description: string;
  url: string;
  tags: string[];
  category: string;
  date?: Date;
  isWiki?: boolean;
  author?: {
    name: string;
    avatar?: string;
    title?: string;
  };
}

const { title, description, url, tags, category, date, isWiki = false, author } = Astro.props;
const encodedCategory = encodeURIComponent(category);
---

<article class="group relative flex flex-col h-full overflow-hidden bg-white dark:bg-primary-900 rounded-xl border border-primary-100 dark:border-primary-800 transition duration-300 ease-in-out hover:shadow-lg hover:border-primary-200 dark:hover:border-primary-700">
  <div class="flex-1 p-6">
    <header class="mb-4">
      <div class="flex flex-wrap items-center gap-2 mb-3 text-sm">
        <span 
          class:list={[
            "inline-flex items-center px-3 py-1.5 rounded-lg text-xs font-medium",
            {
              "bg-accent-100 text-accent-700 dark:bg-accent-900/50 dark:text-accent-300": isWiki,
              "bg-primary-100 text-primary-700 dark:bg-primary-800/50 dark:text-primary-300": !isWiki
            }
          ]}
        >
          {isWiki ? "Wiki" : "Blog"}
        </span>
        
        <a 
          href={`/categories/${encodedCategory}`}
          class="inline-flex items-center px-3 py-1.5 rounded-lg text-xs font-medium bg-primary-50 text-primary-600 hover:bg-primary-100 dark:bg-primary-800/30 dark:text-primary-300 dark:hover:bg-primary-700/50 transition-colors"
          onclick="event.stopPropagation()"
        >
          {category}
        </a>
        
        {date && (
          <time datetime={date.toISOString()} class="text-primary-500 dark:text-primary-400 ml-auto">
            {format(date, 'MMM d, yyyy')}
          </time>
        )}
      </div>

      <a href={url} class="block group-hover:no-underline">
        <h2 class="text-xl font-semibold text-primary-900 dark:text-primary-100 group-hover:text-accent-600 dark:group-hover:text-accent-400 transition-colors line-clamp-2 mb-2">
          {title}
        </h2>
      </a>
    </header>

    <div class="flex-1">
      <p class="text-primary-600 dark:text-primary-300 line-clamp-3 mb-4">
        {description}
      </p>

      {author && (
        <div class="flex items-center gap-3 mb-4">
          {author.avatar && (
            <img 
              src={author.avatar} 
              alt={`${author.name}'s avatar`}
              class="w-8 h-8 rounded-full object-cover bg-primary-100 dark:bg-primary-800"
              loading="lazy"
              decoding="async"
            />
          )}
          <div class="flex flex-col">
            <span class="text-sm font-medium text-primary-700 dark:text-primary-300">
              {author.name}
            </span>
            {author.title && (
              <span class="text-xs text-primary-500 dark:text-primary-400">
                {author.title}
              </span>
            )}
          </div>
        </div>
      )}
    </div>

    <footer class="pt-4 mt-auto border-t border-primary-100 dark:border-primary-800">
      <TagList tags={tags} />
    </footer>
  </div>
  
  <a 
    href={url}
    class="absolute inset-0 z-0 focus:ring-2 focus:ring-accent-500 focus:ring-offset-2 dark:focus:ring-offset-primary-950 rounded-xl"
    aria-label={`Read more about ${title}`}
  ></a>
</article>